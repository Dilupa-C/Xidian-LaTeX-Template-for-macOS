name: Release Template

on:
  # ç›‘å¬ Release å‘å¸ƒäº‹ä»¶ï¼ˆç½‘é¡µç«¯æ“ä½œè§¦å‘ï¼‰
  release:
    types: [published]
  # ç›‘å¬ Tag æ¨é€äº‹ä»¶ï¼ˆå‘½ä»¤è¡Œæ“ä½œè§¦å‘ï¼‰
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  package-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create macOS Package
        # æ’é™¤ Gitæ–‡ä»¶ã€Githubé…ç½®ã€Windowsè¯´æ˜ã€ä»¥åŠå¯èƒ½å­˜åœ¨çš„ zip æ–‡ä»¶
        run: |
          zip -r Xidian-LaTeX-Template-macOS.zip . -x "*.git*" -x ".github/*" -x ".gitignore" -x "WINDOWS_README.md" -x "*.zip"

      - name: Create Windows Package
        # æ’é™¤ Gitæ–‡ä»¶ã€Githubé…ç½®ã€macOSå­—ä½“ã€MacTeXè®¾ç½®è„šæœ¬ã€ä»¥åŠä¹‹å‰ç”Ÿæˆçš„ macOS zip åŒ…
        run: |
          zip -r Xidian-LaTeX-Template-Windows.zip . -x "*.git*" -x ".github/*" -x ".gitignore" -x "Font/*" -x "MacTex_Installation_Settings/*" -x "switch-texlive.sh" -x "*.zip"

      - name: Generate Fixed Release Note
        # ç”Ÿæˆå›ºå®šçš„è¯´æ˜ä¿¡æ¯æ–‡ä»¶
        run: |
          cat <<EOF > release_note_footer.md
          
          ---
          ## ğŸ“¥ ä¸‹è½½ä¸å®‰è£… / Download & Install
          
          | æ“ä½œç³»ç»Ÿ / OS | æ¨èæ–‡ä»¶ / Recommended File | è¯´æ˜ / Note |
          | :--- | :--- | :--- |
          | **macOS** | \`Xidian-LaTeX-Template-macOS.zip\` | âœ… å†…å«å­—ä½“ & é…ç½®è„šæœ¬ (Includes fonts & scripts) |
          | **Windows** | \`Xidian-LaTeX-Template-Windows.zip\` | ğŸš€ ç²¾ç®€ç‰ˆ (Lite version) |
          
          > âš ï¸ **æ³¨æ„ / Warning**: è¯·å‹¿ç›´æ¥ä¸‹è½½ \`Source code\`ï¼Œé™¤éä½ ç†Ÿæ‚‰ Git æ“ä½œã€‚è¯·ä¸‹è½½ä¸Šæ–¹è¡¨æ ¼ä¸­çš„ \`.zip\` æ–‡ä»¶ã€‚
          > Please download the \`.zip\` files listed above, NOT the \`Source code\`.
          
          ## ğŸ“– ä½¿ç”¨æ–‡æ¡£ / Documentation
          - [ä¸­æ–‡æ–‡æ¡£ (Chinese)](https://github.com/Ronchy2000/Xidian-LaTeX-Template-for-macOS/blob/master/README.md)
          - [English Guide](https://github.com/Ronchy2000/Xidian-LaTeX-Template-for-macOS/blob/master/README_EN.md)
          EOF

      - name: Upload Release Assets
        uses: softprops/action-gh-release@v1
        with:
          files: |
            Xidian-LaTeX-Template-macOS.zip
            Xidian-LaTeX-Template-Windows.zip
          body_path: release_note_footer.md
          append_body: true        # å…³é”®ï¼šå°†å›ºå®šè¯´æ˜è¿½åŠ åˆ°ç°æœ‰å†…å®¹åé¢ï¼Œè€Œä¸æ˜¯è¦†ç›–
          generate_release_notes: true # å¦‚æœæ˜¯å‘½ä»¤è¡Œæ‰“tagï¼Œè‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

